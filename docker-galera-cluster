version: '3.8'

services:
  mariadb-galera1:
    image: bitnami/mariadb-galera:latest
    environment:
      - MARIADB_ROOT_PASSWORD=supertajneheslo
      - MARIADB_GALERA_CLUSTER_NAME=galera_cluster
      - MARIADB_GALERA_MARIABACKUP_USER=backup
      - MARIADB_GALERA_MARIABACKUP_PASSWORD=backup
      - MARIADB_GALERA_CLUSTER_BOOTSTRAP=yes
    ports:
      - "3306:3306"    # Pro připojení MySQL klienta
      # Další porty používané Galera (volitelně, pokud potřebujete přístup zvenčí):
      #- "4567:4567"   # Replikační komunikace
      #- "4444:4444"   # SST (State Snapshot Transfer)
      #- "4568:4568"   # IST (Incremental State Transfer)
    networks:
      - galera_network

  mariadb-galera2:
    image: bitnami/mariadb-galera:latest
    environment:
      - MARIADB_ROOT_PASSWORD=supertajneheslo
      - MARIADB_GALERA_CLUSTER_NAME=galera_cluster
      - MARIADB_GALERA_MARIABACKUP_USER=backup
      - MARIADB_GALERA_MARIABACKUP_PASSWORD=backup
    ports:
      - "3307:3306"
    depends_on:
      - mariadb-galera1
    networks:
      - galera_network

  mariadb-galera3:
    image: bitnami/mariadb-galera:latest
    environment:
      - MARIADB_ROOT_PASSWORD=supertajneheslo
      - MARIADB_GALERA_CLUSTER_NAME=galera_cluster
      - MARIADB_GALERA_MARIABACKUP_USER=backup
      - MARIADB_GALERA_MARIABACKUP_PASSWORD=backup
    ports:
      - "3308:3306"
    depends_on:
      - mariadb-galera1
    networks:
      - galera_network

networks:
  galera_network:
    driver: bridge
